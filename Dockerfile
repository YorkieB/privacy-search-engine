# Multi-stage build for React frontend\nFROM node:18-alpine AS frontend-build\nWORKDIR /app/frontend\nCOPY frontend/package*.json ./\nRUN npm ci --only=production\nCOPY frontend/ ./\nRUN npm run build\n\n# Backend with served frontend\nFROM node:18-alpine AS backend\nWORKDIR /app\n\n# Copy backend files\nCOPY backend/package*.json ./\nRUN npm ci --only=production\nCOPY backend/ ./\n\n# Copy built frontend\nCOPY --from=frontend-build /app/frontend/dist ./public\n\n# Create non-root user\nRUN addgroup -g 1001 -S nodejs\nRUN adduser -S nextjs -u 1001\nUSER nextjs\n\nEXPOSE 3001\n\nCMD [\"npm\", \"start\"]